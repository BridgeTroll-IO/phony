#!/usr/bin/env bash

set -e

if [[ "${TRAVIS_PULL_REQUEST}" == "false" && "$TRAVIS_BRANCH" == "develop" && "$TRAVIS_PHP_VERSION" == "$ARCHER_PUBLISH_VERSION" ]]; then
    scripts/build-web
    vendor/bin/woodhouse publish eloquent/phony --auth-token "$ARCHER_TOKEN" \
        artifacts/web/index.html:index.html \
        artifacts/web/css:css \
        artifacts/web/img:img \
        artifacts/web/js:js
fi

if [[ "$TRAVIS_PHP_VERSION" == "$ARCHER_PUBLISH_VERSION" ]]; then
    phpdbg -qrr vendor/bin/phpunit -c phpunit.coverage.xml
    bash <(curl -s https://codecov.io/bash)
    doc/example/run-all
else
    vendor/bin/phpunit
fi
