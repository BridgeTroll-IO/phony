#!/usr/bin/env bash

set -e

if [[ "${TRAVIS_PULL_REQUEST}" == "false" && "$TRAVIS_BRANCH" == "develop" && "$TRAVIS_PHP_VERSION" == "$ELOQUENT_PUBLISH_VERSION" ]]; then
    scripts/build-web
    vendor/bin/woodhouse publish eloquent/phony --auth-token "$GITHUB_TOKEN" \
        artifacts/web/index.html:index.html \
        artifacts/web/css:css \
        artifacts/web/img:img \
        artifacts/web/js:js
fi

if [[ "$TRAVIS_PHP_VERSION" == "$ELOQUENT_PUBLISH_VERSION" ]]; then
    make coverage
    make examples
else
    make test
fi
